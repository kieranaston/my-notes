
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.5">
    
    
      
        <title>Missing data - Kieran's notes</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#missing-data" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Kieran&#39;s notes" class="md-header__button md-logo" aria-label="Kieran's notes" data-md-component="logo">
      
  <img src="../../img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Kieran's notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Missing data
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Kieran&#39;s notes" class="md-nav__button md-logo" aria-label="Kieran's notes" data-md-component="logo">
      
  <img src="../../img/logo.png" alt="logo">

    </a>
    Kieran's notes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Python data science topics
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Python data science topics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reading-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reading data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sqlite-pandas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite and pandas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data-operations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basic Python data operations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../python-strings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Working with strings in Python
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plots/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Working with plots
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../regression/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Regression
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#checking-for-missing-values" class="md-nav__link">
    <span class="md-ellipsis">
      Checking for missing values
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reassigning-missing-values" class="md-nav__link">
    <span class="md-ellipsis">
      Reassigning missing values
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-columns-of-useful-data" class="md-nav__link">
    <span class="md-ellipsis">
      Adding columns of useful data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sampling-data-for-test-and-train-sets-manual-split" class="md-nav__link">
    <span class="md-ellipsis">
      Sampling data for test and train sets (manual split)
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="missing-data">Missing data</h1>
<p>There are many ways to deal with missing values when dealing with a dataframe.</p>
<h2 id="checking-for-missing-values">Checking for missing values</h2>
<p><code>missing_values = custdata.isna().sum()</code></p>
<h2 id="reassigning-missing-values">Reassigning missing values</h2>
<p>Say you have data on employment status, with a number of NaN values. You could reassign those NaN values to "missing":</p>
<div class="highlight"><pre><span></span><code><span class="n">custdata</span><span class="p">[</span><span class="s2">&quot;is.employed.fixed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span>
    <span class="n">custdata</span><span class="p">[</span><span class="s2">&quot;is.employed&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="kc">True</span><span class="p">:</span> <span class="s2">&quot;employed&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">:</span> <span class="s2">&quot;not employed&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">:</span> <span class="s2">&quot;missing&quot;</span><span class="p">}),</span>
    <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;not employed&quot;</span><span class="p">,</span> <span class="s2">&quot;employed&quot;</span><span class="p">,</span> <span class="s2">&quot;missing&quot;</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div>
<p>Creating a new column for the cleaned data is best so that we keep the original data intact. Making the data categorical type rather than plain strings will make working with it simpler and more efficient.</p>
<p>Now lets clean up the income column as well:</p>
<div class="highlight"><pre><span></span><code><span class="n">custdata</span><span class="p">[</span><span class="s2">&quot;income_fixed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">custdata</span><span class="p">[</span><span class="s2">&quot;is.employed&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span> <span class="o">|</span> <span class="p">(</span><span class="n">custdata</span><span class="p">[</span><span class="s2">&quot;income&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
    <span class="n">custdata</span><span class="p">[</span><span class="s2">&quot;income&quot;</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div>
<p>If the individual's employment status is missing', or if their income is negative, their income is set to NaN. Otherwise, the original income value is kept.</p>
<p>We can replace the missing income values with the overall mean income:</p>
<div class="highlight"><pre><span></span><code><span class="n">custdata</span><span class="p">[</span><span class="s2">&quot;income_fixed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">custdata</span><span class="p">[</span><span class="s2">&quot;income_fixed&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">custdata</span><span class="p">[</span><span class="s2">&quot;income_fixed&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</code></pre></div>
<p>We can also replace with mean income per state so that it is more accurate to the state the individual is in:</p>
<div class="highlight"><pre><span></span><code><span class="n">custdata</span><span class="p">[</span><span class="s2">&quot;income_fixed2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">custdata</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;state.of.res&quot;</span><span class="p">)[</span><span class="s2">&quot;income&quot;</span><span class="p">]</span>\
    <span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()))</span>
</code></pre></div>
<p>This code groups data by state, then applies a function to each group that fills the NaN values with the mean of the group.</p>
<p>Lastly, we can also just replace missing income with 0:</p>
<p><code>custdata["income_fixed3"] = custdata["income"].fillna(0)</code></p>
<h2 id="adding-columns-of-useful-data">Adding columns of useful data</h2>
<p>Create a new table showing the average incomes by state:</p>
<div class="highlight"><pre><span></span><code><span class="n">avg_income_by_state</span> <span class="o">=</span> <span class="n">custdata</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;state.of.res&quot;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s2">&quot;income&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">avg_income_by_state</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;income&quot;</span><span class="p">:</span> <span class="s2">&quot;avg.income&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># as_index=False keeps the state as a column instead of an index, which makes a difference in how you can work with it</span>
<span class="c1"># mean(numeric_only=True) ensures that only numeric columns are considered for the mean calculation</span>
</code></pre></div>
<p>Adding a column with standardized age (z-score):</p>
<p><code>custdata["age.normalized"] = (custdata["age"] - custdata["age"].mean()) / custdata["age"].std()</code></p>
<p>We calculate the z-score for the 'age' column by subtracting the mean and dividing by the standard deviation. This results in a new column 'age.normalized' that has a mean of 0 and a standard deviation of 1.</p>
<p>Normalizing income by state median:</p>
<p>Group the data by 'state.of.res' and normalize the income within each state. Show income relative to the median income of each state.</p>
<div class="highlight"><pre><span></span><code><span class="n">custdata</span><span class="p">[</span><span class="s2">&quot;income.nrml.by.state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">custdata</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;state.of.res&quot;</span><span class="p">)[</span><span class="s2">&quot;income&quot;</span><span class="p">]</span>\
    <span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">/</span> <span class="n">x</span><span class="o">.</span><span class="n">median</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</code></pre></div>
<p>The transform function applies normalization to each group, while the lambda function divides each income value by the median income of its respective state and multiplies by 100.</p>
<h2 id="sampling-data-for-test-and-train-sets-manual-split">Sampling data for test and train sets (manual split)</h2>
<p>For the test set we could randomly sample 10% of the rows, and use the rest for the training set:</p>
<div class="highlight"><pre><span></span><code><span class="n">n_rows</span> <span class="o">=</span> <span class="n">custdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">test_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">n_rows</span><span class="p">),</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">train_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_rows</span><span class="p">),</span> <span class="n">test_idx</span><span class="p">)</span>

<span class="c1"># create training and test sets using the indices we just got</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">custdata</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">]</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">custdata</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_idx</span><span class="p">]</span>
</code></pre></div>
<p>Sampling using random uniform instead:</p>
<div class="highlight"><pre><span></span><code><span class="n">custdata</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">n_rows</span><span class="p">)</span>
<span class="n">train_alt</span> <span class="o">=</span> <span class="n">custdata</span><span class="p">[</span><span class="n">custdata</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.1</span><span class="p">]</span>
<span class="n">test_alt</span> <span class="o">=</span> <span class="n">custdata</span><span class="p">[</span><span class="n">custdata</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">]</span>
</code></pre></div>
<p>We create a randonm sample column with uniform distribution. <code>np.random.uniform()</code> generates random floates between 0 and 1. We then split the data into training and test sets based on this sample.</p>
<p>You go through row by row and if the value for that row is greater than or equal 0.1 you put it in the train set and otherwise it goes in the test set. Since the values should follow a normal distribution this should result in about 10% of the values ending up in the test set. </p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>