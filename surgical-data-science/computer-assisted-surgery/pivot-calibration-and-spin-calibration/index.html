
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../vectors-and-coordinates/">
      
      
        <link rel="next" href="../fiducial-registration/">
      
      
      <link rel="icon" href="../../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.5">
    
    
      
        <title>Pivot calibration and spin calibration - Kieran's notes</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="brown" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pivot-calibration-spin-calibration" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Kieran&#39;s notes" class="md-header__button md-logo" aria-label="Kieran's notes" data-md-component="logo">
      
  <img src="../../../img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Kieran's notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Pivot calibration and spin calibration
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Kieran&#39;s notes" class="md-nav__button md-logo" aria-label="Kieran's notes" data-md-component="logo">
      
  <img src="../../../img/logo.png" alt="logo">

    </a>
    Kieran's notes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Surgical data science
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Surgical data science
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Computer-assisted surgery
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Computer-assisted surgery
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../what-is-surgical-data-science/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../computer-assisted-surgery/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Computer-assisted surgery
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../transformation-representations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transformation representations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../transformations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transformations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../vectors-and-coordinates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vectors and coordinates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Pivot calibration and spin calibration
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Pivot calibration and spin calibration
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-do-we-find-the-transformation-from-the-tooltip-coordinate-frame-to-the-tool-coordinate-frame" class="md-nav__link">
    <span class="md-ellipsis">
      How do we find the transformation from the tooltip coordinate frame to the tool coordinate frame?
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fiducial-registration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fiducial registration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../icp-registration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ICP registration
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-do-we-find-the-transformation-from-the-tooltip-coordinate-frame-to-the-tool-coordinate-frame" class="md-nav__link">
    <span class="md-ellipsis">
      How do we find the transformation from the tooltip coordinate frame to the tool coordinate frame?
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="pivot-calibration-spin-calibration">Pivot calibration &amp; spin calibration</h1>
<p>So say we have a reference frame defined by a sensor on a head or something, in addition to a frame for the scalpel tip, the scalpel, and the image.</p>
<p>Our goal is to get the transformation from the scalpel tip to the image: <span class="arithmatex">\(T^{\text{ScalpelTip} \rightarrow \text{Image}}\)</span></p>
<p>This transformation is given by the product of the following transformations:</p>
<div class="arithmatex">\[
T^{\text{ScalpelTip} \rightarrow \text{Image}} = T^{\text{Reference}\rightarrow \text{Image}}T^{\text{Scalpel}\rightarrow \text{Reference}}T^{\text{ScalpelTip}\rightarrow \text{Scalpel}}
\]</div>
<p>Our goal is to get the position of the scalpel tip in the image coordinate system.
1. Transform from scalpel tip to scalpel
2. Transform from scalpel to reference (frame for the tracker on head)
3. Transform from reference to image (so that we correctly see the location of the scalpel tip in the image)</p>
<p><strong>Transformation from Reference <span class="arithmatex">\(\rightarrow\)</span> Image:</strong></p>
<p>This transformation is fixed because the reference tracker stays in the same spot.</p>
<p><strong>Transformation from Scalpel <span class="arithmatex">\(\rightarrow\)</span> Reference:</strong></p>
<p>This transformation describes the position of the scalpel relative to the reference tracker.</p>
<p>It is obtained dynamically from the tracking system.</p>
<p><strong>Transformation from ScalpelTip <span class="arithmatex">\(\rightarrow\)</span> Scalpel:</strong></p>
<p>Since the scalpel tip has a known, fixed offset from the scalpel's main tracking point, this is a static transformation assuming the scalpel shape does not change.</p>
<h2 id="how-do-we-find-the-transformation-from-the-tooltip-coordinate-frame-to-the-tool-coordinate-frame">How do we find the transformation from the tooltip coordinate frame to the tool coordinate frame?</h2>
<p><strong>Finding the translation: Pivot calibration</strong></p>
<p>The idea is to think of the tooltip as the center of a sphere, with the main tool tracker being offset from it by some distance along the shaft of the scalpel. Then as we rotate the tool, the main tool tracker will be at points along the surface of the sphere, distanced from the tooltip by the radius of the sphere.</p>
<p>We call <span class="arithmatex">\([x_i^{\text{Tr}}, y_i^{\text{Tr}}, z_i^{\text{Tr}}]\)</span> the origin of the tool coordinate frame with respect to the tracker (attached to the tool).</p>
<p>We call <span class="arithmatex">\([x_c^{\text{Tr}}, y_c^{\text{Tr}}, z_c^{\text{Tr}}]\)</span> the centre of the sphere with respect to the tracker.</p>
<p>We call <span class="arithmatex">\(r\)</span> the sphere's radius.</p>
<p>From the equation for the radius of a sphere, we see that the following must be true:</p>
<div class="arithmatex">\[
(x_1-x_c)^2+(y_1-y_c)^2+(z_1-z_c)^2=r^2
\]</div>
<p>When simplifying this we see that:</p>
<div class="arithmatex">\[
-2x_ix_c-2y_iy_c-2z_iz_c+(x_c^2-y_c^2+z_c^2-r^2)=-x_i^2-y_i^2-z_i^2
\]</div>
<p>We observe that <span class="arithmatex">\(d = (x_c^2-y_c^2+z_c^2-r^2)\)</span> is a constant term and we can solve for it later once we find the coordinates of the tooltip.</p>
<p>We end up with the following system of equations in matrix form (for multiple points on the surface of the sphere <span class="arithmatex">\(i=1, 2, \dots, n\)</span>):</p>
<div class="arithmatex">\[
\begin{bmatrix}-2x_i &amp; -2y_i &amp; -2z_i &amp; 1\\ \vdots &amp; \vdots &amp; \vdots &amp; \vdots\\-2x_n &amp; -2y_n &amp; -2z_n &amp; 1\end{bmatrix}\begin{bmatrix}x_c\\y_c\\z_c\\d\end{bmatrix}=\begin{bmatrix}-x_i^2-y_i^2-z_i^2\\ \vdots\\-x_n^2-y_n^2-z_n^2\end{bmatrix}
\]</div>
<p>This equation takes the form: <span class="arithmatex">\(A\mathbf{x}=\mathbf{b}\)</span></p>
<p>And we can solve for the sphere's center <span class="arithmatex">\(\mathbf{x}\)</span> like so:</p>
<div class="arithmatex">\[
\mathbf{x}=(A^TA)^{-1}A^T\mathbf{b}
\]</div>
<p>This gave us <span class="arithmatex">\(d\)</span> as well, so we can now calculate the radius:</p>
<div class="arithmatex">\[
r^2=d-x_c^2-y_c^2-z_c^2
\]</div>
<p>What did we achieve? We now have the position of the tooltip relative to the tracker, as well as the distance from the tool sensor to the tooltip.</p>
<p>What do we need now?</p>
<p>We got <span class="arithmatex">\([x_c^{\text{Tr}}, y_c^{\text{Tr}}, z_c^{\text{Tr}}]\)</span> (position of the tooltip with respect to the tracker), but we want <span class="arithmatex">\([x_c^{\text{Tool}}, y_c^{\text{Tool}}, z_c^{\text{Tool}}]\)</span> (the position of the tooltip relative to the tool, which is the other tracker on the scalpel).</p>
<div class="arithmatex">\[
\begin{bmatrix}x_c^{\text{Tool}}\\y_c^{\text{Tool}}\\z_c^{\text{Tool}}\\1\end{bmatrix}=T^{\text{Tracker}\rightarrow\text{Tool}}\begin{bmatrix}x_c^{\text{Tr}}\\y_c^{\text{Tr}}\\z_c^{\text{Tr}}\\1\end{bmatrix}
\]</div>
<p>This is simply multiplying the given transformation from the tracker to the tool by the tooltip position relative to the tracker that we just obtained.</p>
<p>Once we have the position of the tooltip relative to the tool, to get the transformation from tooltip to tool it is just a translation:</p>
<div class="arithmatex">\[
T^{\text{Tooltip} \rightarrow \text{Tool}}=\begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; x_c^{\text{Tool}} \\
0 &amp; 1 &amp; 0 &amp; y_c^{\text{Tool}}\\
0 &amp; 0 &amp; 1 &amp; z_c^{\text{Tool}} \\
0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix}
\]</div>
<p>This is a homeogeneous transformation matrix representing the translation from the tooltip to the tool.</p>
<p><strong>Finding the rotation: Spin calibration</strong></p>
<p>Remember our goal is to determine a transformation from the tool coordinate frame to the tracker (world) frame. We already got the translation with pivot calibration, now we will get the rotation with spin calibration.</p>
<p>Call <span class="arithmatex">\(R_i^{\text{Tool} \rightarrow \text{Tracker}}, R_J^{\text{Tool} \rightarrow \text{Tracker}}\)</span></p>
<p>These describe different orientations of the tool at different times.</p>
<div class="arithmatex">\[
R^{\text{Tool}_i \rightarrow \text{Tool}_j}=(R^{\text{Tracker} \rightarrow \text{Tool}_j})(R^{\text{Tracker} \rightarrow \text{Tool}_i})
\]</div>
<p>We get the product of those different orientations to determine the relative rotation, which should be around the tool's fixed rotation axis. We can call this <span class="arithmatex">\(R\)</span>.</p>
<p><span class="arithmatex">\(R\mathbf{v}=\mathbf{v}\)</span> such that <span class="arithmatex">\(\lvert\lvert \mathbf{v} \rvert\rvert\)</span> for all instantaneous rotations.</p>
<p>We are essentially asking, <em>"what single axis explains all these rotations?</em></p>
<p>Now we want to find <span class="arithmatex">\(\mathbf{v}\)</span> minimizing the following:</p>
<p><span class="arithmatex">\(\mathbf{v}^T\left[\sum_{i, j}(R-I)^T(R-I)\right]\mathbf{v}\)</span> such that <span class="arithmatex">\(\lvert\lvert \mathbf{v}\rvert\rvert = 1\)</span></p>
<p>This essentially measures how much the observed rotations deviate from being purely around the axis <span class="arithmatex">\(\mathbf{v}\)</span>.</p>
<p>We can say that <span class="arithmatex">\(M=\sum_{i, j}(R-I)^T(R-I)\)</span></p>
<p>We can take <span class="arithmatex">\(\mathbf{v}\)</span> as the eigenvector of <span class="arithmatex">\(M\)</span> with the smallest eigenvalue (which represents the least deviation from the assumption that all rotations are around <span class="arithmatex">\(\mathbf{v}\)</span>).</p>
<p><span class="arithmatex">\(\mathbf{v}\)</span> is in the tool coordinate frame.</p>
<div class="arithmatex">\[
T^{\text{Tooltip} \rightarrow \text{Tool}}=\begin{bmatrix}\mathbf{v} &amp; \mathbf{u}_1 &amp; \mathbf{u}_2 &amp; \mathbf{t}\\0 &amp; 0 &amp; 0 &amp; 1\end{bmatrix}
\]</div>
<p><span class="arithmatex">\(\mathbf{u}_1, \mathbf{u}_2\)</span> are orthogonal to <span class="arithmatex">\(\mathbf{v}\)</span></p>
<p>What we just defined is our tool coordinate frame. It contains our axis of rotation, the other axes (orthogonal to our rotation axis), and the translation vector from the tool's origin to the tooltip.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>